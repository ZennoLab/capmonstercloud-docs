---
sidebar_position: 5
sidebar_label: HCaptchaTask
draft: true
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import ParamItem from '@theme/ParamItem';
import MethodItem from '@theme/MethodItem';
import MethodDescription from '@theme/MethodDescription'
import PriceBlock from '@theme/PriceBlock';
import PriceBlockWrap from '@theme/PriceBlockWrap';
import { ArticleHead } from '../../../../../src/theme/ArticleHead';

<ArticleHead slug="captchas/hcaptcha-task" />

# HCaptchaTask

<PriceBlockWrap>
  <PriceBlock title="hCaptcha" name="hCaptchaToken"/>
  <PriceBlock title="hCaptcha Enterprise" name="hCaptchaEnterpriseToken"/>
</PriceBlockWrap>

本节包含有关 hCaptcha 解决任务的信息。为了为此类任务提供高度通用性，我们会重现您计划完成的自动化任务所使用的所有环境元素。这包括：代理访问、浏览器的用户代理、Cookie（可选）。这种方法可以消除未来可能出现的所有障碍。

此类验证码的解决时间可能比普通图片验证码略长，但问题可以通过我们生成的 `g-captcha-response` 值得到补偿——在我们解决您的验证码后，该值在接下来的 60 秒内有效。

:::warning **注意！**
CapMonster Cloud 默认通过内置代理工作——这些代理已包含在费用内。仅当网站不接受令牌或对内置服务的访问受限时，才需要指定您自己的代理。

如果代理按 IP 授权，请将地址 **65.21.190.34** 加入白名单。
:::

## 请求参数

<Tabs className="full-width-tabs filled-tabs" groupId="captcha-type">
  <TabItem value="proxyless" label="HCaptchaTask（无代理）" default className="bordered-panel">
    <ParamItem title="type" required type="string" />
    **HCaptchaTask**

    ---

    <ParamItem title="websiteURL" required type="string" />
    包含 hCaptcha 的网页地址。

    ---

    <ParamItem title="websiteKey" required type="string" />
    hCaptcha 网站密钥。

    ---

    <ParamItem title="isInvisible" type="boolean" />
    如果是 hCaptcha 隐形版本，请使用 true。

    ---

    <ParamItem title="data" type="string" />
    <p>某些 hCaptcha 实现中使用的自定义数据，通常在 `isInvisible=true` 时需要。<br/>
    data 字段的值可以从用于渲染验证码的 `rqdata` 参数中获取。</p>

    ---

    <ParamItem title="userAgent" type="string" />
    **仅传递来自 Windows 操作系统的真实 UA。目前为：** userAgentPlaceholder

    ---

    <ParamItem title="cookies" type="string" />
    <p>在与目标页面交互过程中必须使用的附加 Cookie。</p><p>**格式**：cookiename1=cookievalue1; cookiename2=cookievalue2</p>

    ---

    <ParamItem title="fallbackToActualUA" type="boolean" />
    <p>**true** - 指定此参数时，我们会忽略用户在请求中发送的无效 User Agent，并在 getTaskResult 中返回我们自己的（有效的）User Agent。这将提高令牌的通过率。</p><p>**false** - 我们将使用请求中指定的 User Agent。如果 User Agent 无效，您将收到错误 ERROR_WRONG_USERAGENT（日志中显示 USERAGENT IS EXPIRED）。</p>

  </TabItem>
  
  <TabItem value="proxy" label="HCaptchaTask（使用代理）" className="bordered-panel">
    <ParamItem title="type" required type="string" />
    **HCaptchaTask**

    ---

    <ParamItem title="websiteURL" required type="string" />
    包含 hCaptcha 的网页地址。

    ---

    <ParamItem title="websiteKey" required type="string" />
    hCaptcha 网站密钥。

    ---

    <ParamItem title="isInvisible" type="boolean" />
    如果是 hCaptcha 隐形版本，请使用 true。

    ---

    <ParamItem title="data" type="string" />
    <p>某些 hCaptcha 实现中使用的自定义数据，通常在 `isInvisible=true` 时需要。<br/>
    data 字段的值可以从用于渲染验证码的 `rqdata` 参数中获取。</p>

    ---

    <ParamItem title="userAgent" type="string" />
    **仅传递来自 Windows 操作系统的真实 UA。目前为：** userAgentPlaceholder

    ---

    <ParamItem title="cookies" type="string" />
    <p>在与目标页面交互过程中必须使用的附加 Cookie。</p><p>**格式**：cookiename1=cookievalue1; cookiename2=cookievalue2</p>

    ---

    <ParamItem title="fallbackToActualUA" type="boolean" />
    <p>**true** - 指定此参数时，我们会忽略用户在请求中发送的无效 User Agent，并在 getTaskResult 中返回我们自己的（有效的）User Agent。这将提高令牌的通过率。</p><p>**false** - 我们将使用请求中指定的 User Agent。如果 User Agent 无效，您将收到错误 ERROR_WRONG_USERAGENT（日志中显示 USERAGENT IS EXPIRED）。</p>

    ---

    <ParamItem title="proxyType" required type="string" />
    **http** - 常规 http/https 代理；<br />**https** - 仅当 "http" 不起作用时尝试（某些自定义代理需要）；<br />**socks4** - socks4 代理；<br />**socks5** - socks5 代理。

    ---

    <ParamItem title="proxyAddress" required type="string" />
    <p>
      IPv4/IPv6 代理 IP 地址。不允许：
      - 使用主机名；
      - 使用透明代理（可以看到客户端 IP）；
      - 使用本地机器上的代理。
    </p>

    ---

    <ParamItem title="proxyPort" required type="integer" />
    代理端口。

    ---

    <ParamItem title="proxyLogin" type="string" />
    代理服务器用户名。

    ---

    <ParamItem title="proxyPassword" type="string" />
    代理服务器密码。

  </TabItem>
  
</Tabs>

## 支持的任务类型

支持所有主要任务类型，例如：

* **DragAndDrop** – 将元素拖动到正确位置
* **Click** – 点击某个元素
* **3x3 / YesNo** – 根据给定条件选择图片

## 创建任务方法

<Tabs className="full-width-tabs filled-tabs request-tabs" groupId="captcha-type">
	<TabItem value="proxyless" label="HCaptchaTask（不使用代理）" default className="method-panel">
		<MethodItem>
			```http
			https://api.capmonster.cloud/createTask
			```
		</MethodItem>
		<MethodDescription>
**请求**
  ```json
  {
    "clientKey":"API_KEY",
    "task":
    {
      "type":"HCaptchaTask",
      "websiteURL":"https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
      "websiteKey":"472fc7af-86a4-4382-9a49-ca9090474471",
      "userAgent": "userAgentPlaceholder",
      "fallbackToActualUA":true
    }
  }
```


**响应**


```json
{
  "errorId":0,
  "taskId":407533072
}
```
	</MethodDescription>
</TabItem>

<TabItem value="proxy" label="HCaptchaTask（使用代理）" className="method-panel">
	<MethodItem>
		```http
		https://api.capmonster.cloud/createTask
		```
	</MethodItem>
	<MethodDescription>
**请求**

```json
{
  "clientKey":"API_KEY",
  "task":
  {
    "type":"HCaptchaTask",
    "websiteURL":"https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
    "websiteKey":"472fc7af-86a4-4382-9a49-ca9090474471",
    "userAgent": "userAgentPlaceholder",
    "fallbackToActualUA":true,
    "proxyType":"http",
    "proxyAddress":"8.8.8.8",
    "proxyPort":8080,
    "proxyLogin":"proxyLoginHere",
    "proxyPassword":"proxyPasswordHere"
  }
}
```
**响应**

```json
{
  "errorId":0,
  "taskId":407533072
}
```
	</MethodDescription>
</TabItem>

</Tabs>

## 获取任务结果方法

使用 [getTaskResult](../api/methods/get-task-result.mdx) 方法来请求 hCaptcha 的答案。根据服务负载情况，您将在 10 - 80 秒内收到响应。

<TabItem value="proxyless" label="HCaptchaTask（无代理）" default className="method-panel-full">
	<MethodItem>
		```http
		https://api.capmonster.cloud/getTaskResult
		```
	</MethodItem>
	<MethodDescription>
		**请求**
		```json
		{
		  "clientKey":"API_KEY",
		  "taskId": 407533072
		}
		```
		**响应**
 ```json
  {
    "errorId": 0,
    "status": "ready",
    "solution": {
      "gRecaptchaResponse": "P1_eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.hKdwYXNza2V5xQb9JvlblBqjTdKpourvlRNpOZLvJb0yJRmsXVFVjyxFWlL1wdYBXaPyFtnxwy2ukbMgwWn62-cjSc98Iw2XIPYWg5MNDKS4_7tBIhjY0PienoKy1...",
      "respKey": "E0_eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoidjQ3RjlqZGFYTllFQXlZZFYyRTlaWlBVQUdLaFpPakpRNjBXRTljVW40VnY3NnhuN2V3R0wwVWd1MW1Wai90WEdoYmt5a2NqVGlGdWpsSlpmVjcza...",
      "userAgent": "userAgentPlaceholder"
    }
  }
  ```
	</MethodDescription>
</TabItem>

<br />

| **属性**             | **类型** | **说明**                                                            |
| :----------------- | :----- | :---------------------------------------------------------------- |
| gRecaptchaResponse | String | 应插入到目标网站 hCaptcha 提交表单中的哈希值。                                      |
| userAgent          | String | 在提交时，您应使用与解决 hCaptcha 时相同的 *User Agent*。                          |
| respKey            | String | 当可用时，这是执行 `window.hcaptcha.getRespKey()` 函数返回的结果。某些网站会使用该值进行额外验证。 |

---

# 获取 hCaptcha 参数

要通过 API 成功解决 hCaptcha，您必须获取页面所需的参数：`websiteKey`，以及对于 Invisible 版本 —— 还需要 `data`（`rqdata`）。

以下是定位这些参数的主要方法。

---

## 1. `websiteKey` 参数

### 方法 1：使用 Network 选项卡

1. 打开 **开发者工具（DevTools）**。
2. 进入 **Network** 选项卡。
3. 重新加载包含 hCaptcha 的页面。
4. 在请求列表中，查找以以下内容开头的 URL：

```
checksiteconfig?v=
```

5. 为了快速搜索，请按：

   * **Ctrl + F**（Windows）
   * **Command + F**（macOS）

   并输入关键字：

```
key
```

在匹配的请求中会显示 `sitekey` 参数 —— 这就是 `websiteKey` 的值。

---

### 方法 2：使用 Elements 选项卡

1. 打开 **Elements** 选项卡。
2. 在页面中搜索：

   * `data-sitekey`
   * `sitekey`

最常见的形式如下：

```html
<div class="h-captcha" data-sitekey="XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"></div>
```

`data-sitekey` 属性的值即为您的 `websiteKey`。

---

## 2. `data`（rqdata）参数 —— 适用于 HCaptcha Invisible

在某些网站上（尤其是使用 Invisible 版本时），需要额外的 `rqdata` 参数。

### 重要说明

`rqdata` 值：

* 是**一次性使用**的；
* 每次刷新页面都会重新生成；
* 不能重复使用 —— 使用旧值会导致错误。

---

### 方法 1：在页面源代码中搜索

有时该参数可以直接在 JavaScript 代码中找到，例如：

```js
hcaptcha.setData({ rqdata: "value" })
```

在这种情况下，`"value"` 即为所需的 `data` 参数。

---

### 方法 2：使用 Network 选项卡

1. 打开 **DevTools → Network**。
2. 重新加载带有验证码的页面。
3. 按 **Ctrl + F**（macOS 上为 Command + F）。
4. 在搜索框中输入：

```
data
```

通常，该参数会出现在与以下操作相关的请求中：

* 登录（`login`）
* 注册（`signup`）
* 操作确认

查看这些请求并找到 `rqdata` 字段。

---

## 3. 在 `refreshcaptcha` 请求中查找参数

在某些网站上，hCaptcha 参数会通过一个特殊请求传递：

```
refreshcaptcha
```

### 步骤：

1. 打开 **DevTools → Network**。
2. 刷新页面。
3. 找到 `refreshcaptcha` 请求。
4. 进入 **Response** 选项卡。

对于 CapMonster Cloud 服务，在这种情况下需要以下参数：

* `gid`
* `sitekey`

### 重要说明

`gid` 的值对应于 `data` 参数。

在创建解题请求时：

* `sitekey` → 用作 `websiteKey`
* `gid` → 用作 `data`

---

## 4. 在网站 API 请求中查找参数

有时 hCaptcha 参数不会直接显示，而是包含在网站的内部 API 请求中。

这些请求通常发生在：

* 登录时，
* 注册时，
* 提交表单时。

例如：

```
https://authenticate.example.com/api/v1/login
```

在 **Network** 选项卡中打开相关请求，并检查：

* 请求体（Request Payload），
* 服务器响应（Response）。

诸如 `sitekey`、`rqdata` 和 `gid` 等参数可能包含在这些数据中。

---

## 建议

* 在复制 `rqdata` 之前，请务必刷新页面。
* 确保参数不是动态生成的。
* 如果在 HTML 中找不到参数，请检查 Network 请求。

## 使用 SDK 库

<Tabs className="full-width-tabs filled-tabs request-tabs" groupId="captcha-type">
  <TabItem value="js" label="JavaScript" default className="method-panel">
  <details>
      <summary>显示代码（浏览器）</summary>
```javascript
// https://github.com/ZennoLab/capmonstercloud-client-js

import { CapMonsterCloudClientFactory, ClientOptions, HCaptchaRequest } from '@zennolab_com/capmonstercloud-client';

const API_KEY = "YOUR_API_KEY"; // 指定您的 CapMonster Cloud API 密钥

document.addEventListener("DOMContentLoaded", async () => {
    const client = CapMonsterCloudClientFactory.Create(
        new ClientOptions({ clientKey: API_KEY })
    );

    // 无代理的基本示例
    // CapMonster Cloud 会自动使用自己的代理
    let hcaptchaRequest = new HCaptchaRequest({
        websiteURL: "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy", // 包含 hCaptcha 的页面 URL
        websiteKey: "472fc7af-86a4-4382-9a49-ca9090474471",
        isInvisible: false,                         // 如果使用 Invisible hCaptcha，则设置为 true
        data: "rqdata_value_if_required"            // 某些 Invisible 实现需要此参数
    });

    // 使用您自己的代理示例
    // 如果您想使用自己的代理，请取消注释此代码块
    /*
    const proxy = {
        proxyType: "http",
        proxyAddress: "123.45.67.89",
        proxyPort: 8080,
        proxyLogin: "username",
        proxyPassword: "password"
    };

    hcaptchaRequest = new HCaptchaRequest({
        websiteURL: "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
        websiteKey: "472fc7af-86a4-4382-9a49-ca9090474471",
        isInvisible: false,
        data: "rqdata_value_if_required",
        proxy,
        userAgent: "userAgentPlaceholder"
    });
    */

    // 可选：您可以检查余额
    const balance = await client.getBalance();
    console.log("余额：", balance);

    const result = await client.Solve(hcaptchaRequest);
    console.log("解决结果：", result);
});
```
</details>

<details>
      <summary>显示代码（Node.js）</summary>
```javascript
// https://github.com/ZennoLab/capmonstercloud-client-js

import { CapMonsterCloudClientFactory, ClientOptions, HCaptchaRequest } from '@zennolab_com/capmonstercloud-client';

const API_KEY = "YOUR_API_KEY"; // 指定您的 CapMonster Cloud API 密钥

async function solveHCaptcha() {
    const client = CapMonsterCloudClientFactory.Create(
        new ClientOptions({ clientKey: API_KEY })
    );

    // 无代理的基本示例
    // CapMonster Cloud 会自动使用自己的代理
    let hcaptchaRequest = new HCaptchaRequest({
        websiteURL: "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy", // 包含 hCaptcha 的页面 URL
        websiteKey: "472fc7af-86a4-4382-9a49-ca9090474471",
        isInvisible: false,                         // 如果使用 Invisible hCaptcha，则设置为 true
        data: "rqdata_value_if_required"            // 某些 Invisible 实现需要此参数
    });

    // 使用您自己的代理示例
    // 如果您想使用自己的代理，请取消注释此代码块

    /*
    const proxy = {
        proxyType: "http",
        proxyAddress: "123.45.67.89",
        proxyPort: 8080,
        proxyLogin: "username",
        proxyPassword: "password"
    };

    hcaptchaRequest = new HCaptchaRequest({
        websiteURL: "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
        websiteKey: "472fc7af-86a4-4382-9a49-ca9090474471",
        isInvisible: false,
        data: "rqdata_value_if_required",
        proxy,
        userAgent: "userAgentPlaceholder"
    });
    */

    // 可选：您可以检查余额
    const balance = await client.getBalance();
    console.log("余额：", balance);

    const result = await client.Solve(hcaptchaRequest);
    console.log("解决结果：", result);
}

solveHCaptcha().catch(console.error);
```

</details>

  </TabItem>

 <TabItem value="python" label="Python" className="method-panel">
```python
# https://github.com/ZennoLab/capmonstercloud-client-python

import asyncio
from capmonstercloudclient import CapMonsterClient, ClientOptions
from capmonstercloudclient.requests import HcaptchaRequest
# from capmonstercloudclient.requests.baseRequestWithProxy import ProxyInfo  # 如果计划使用代理，请取消注释

API_KEY = "YOUR_API_KEY"  # 输入您的 CapMonster Cloud API 密钥

async def solve_hcaptcha():
    client_options = ClientOptions(api_key=API_KEY)
    cap_monster_client = CapMonsterClient(options=client_options)

    # 基本示例，无需代理
    # CapMonster Cloud 会自动使用它们的代理
    hcaptcha_request = HcaptchaRequest(
        websiteUrl="https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",  # 含有 hCaptcha 的页面 URL
        websiteKey="472fc7af-86a4-4382-9a49-ca9090474471",
        isInvisible=False,  # True，如果使用 Invisible hCaptcha
        userAgent="userAgentPlaceholder",
        fallbackToActualUA=True
    )

    # 使用您自己的代理的示例
    # 如果想使用自己的代理，请取消注释以下代码块

    # proxy = ProxyInfo(
    #     proxyType="http",
    #     proxyAddress="123.45.67.89",
    #     proxyPort=8080,
    #     proxyLogin="username",
    #     proxyPassword="password"
    # )
    #
    # hcaptcha_request = HcaptchaRequest(
    #     websiteUrl="https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
    #     websiteKey="472fc7af-86a4-4382-9a49-ca9090474471",
    #     isInvisible=False,
    #     userAgent="userAgentPlaceholder",
    #     fallbackToActualUA=True,
    #     proxy=proxy
    # )

    # 如有必要，可以检查余额
    balance = await cap_monster_client.get_balance()
    print("Balance:", balance)

    result = await cap_monster_client.solve_captcha(hcaptcha_request)
    print("Solution:", result)

asyncio.run(solve_hcaptcha())
```
  </TabItem>

  <TabItem value="csharp" label="C#" className="method-panel">
```csharp
// https://github.com/ZennoLab/capmonstercloud-client-dotnet

using System;
using System.Threading.Tasks;
using Zennolab.CapMonsterCloud;
using Zennolab.CapMonsterCloud.Requests;

class Program
{
    static async Task Main(string[] args)
    {
        // 输入您的 CapMonster Cloud API 密钥
        var clientOptions = new ClientOptions
        {
            ClientKey = "YOUR_API_KEY"
        };

        var cmCloudClient = CapMonsterCloudClientFactory.Create(clientOptions);

        // 基本示例，无需代理
        // CapMonster Cloud 会自动使用它们的代理
        var hcaptchaRequest = new HCaptchaRequest
        {
            WebsiteUrl = "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy", // 含有 hCaptcha 的页面 URL
            WebsiteKey = "472fc7af-86a4-4382-9a49-ca9090474471",
            Invisible = false,                          // true -- 如果使用 Invisible hCaptcha
            UserAgent = "userAgentPlaceholder"
        };

        // 使用您自己的代理的示例
        // 如果想使用自己的代理，请取消注释以下代码块

        /*
        hcaptchaRequest = new HCaptchaRequest
        {
            WebsiteUrl = "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
            WebsiteKey = "472fc7af-86a4-4382-9a49-ca9090474471",
            Invisible = false,
            UserAgent = "userAgentPlaceholder",

            Proxy = new ProxyContainer(
                "123.45.67.89",
                8080,
                ProxyType.Http,
                "username",
                "password"
            )
        };
        */

        // 如有必要，可以检查余额
        var balance = await cmCloudClient.GetBalanceAsync();
        Console.WriteLine("Balance: " + balance);

        var hcaptchaResult = await cmCloudClient.SolveAsync(hcaptchaRequest);

        Console.WriteLine("HCaptcha 解决结果: " + hcaptchaResult.Solution.Value);
    }
}
```
  </TabItem>  
</Tabs>




