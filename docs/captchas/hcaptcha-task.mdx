---
sidebar_position: 4
sidebar_label: HCaptchaTask
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import ParamItem from '@theme/ParamItem';
import MethodItem from '@theme/MethodItem';
import MethodDescription from '@theme/MethodDescription'


# HCaptchaTask
Объект содержит данные о задаче на решение hCaptcha. Для обеспечения универсальности решения этого вида капчи нам необходимо использовать все данные, которые вы используете во время автоматизации заполнения формы на целевом сайте, включая прокси, user-agent браузера и cookies. Это позволит избежать любых проблем при изменении кода hCaptcha.

Капча может решаться довольно долго по сравнению с обычной капчей, но это компенсируется тем, что полученный g-captcha-response действует еще 60 секунд после решения капчи.

**Важно!** Если у вас возникли проблемы с принятием токена hcaptcha, свяжитесь с службой поддержки CapMonster Cloud, указав url и sitekey. Мы постараемся решить данную проблему как можно скорее.

## Параметры запроса

<Tabs className="full-width-tabs filled-tabs" groupId="captcha-type">
  <TabItem value="proxyless" label="HCaptchaTaskProxyless (без прокси)" default className="bordered-panel">
    <ParamItem title="type" required type="string" />
    **HCaptchaTaskProxyless**

    ---

    <ParamItem title="websiteURL" required type="string" />
    Адрес страницы на которой решается капча.

    ---

    <ParamItem title="websiteKey" required type="string" />
    Ключ-идентификатор hCaptcha на целевой странице.

    ---

    <ParamItem title="isInvisible" type="boolean" />
    true, если hCaptcha невидимая.

    ---

    <ParamItem title="data" type="string" />
    <p>Дополнительный параметр, используемый в основном с `isInvisible=true`. <br/>
	Значение поля data можно взять из параметра `rqdata`, с которым формируется капча. </p>

    ---

    <ParamItem title="userAgent" type="string" />
    **Передавайте только актуальный UA от ОС Windows. Сейчас таковым является: ** userAgentPlaceholder

    ---

    <ParamItem title="cookies" type="string" />
    <p>Дополнительные cookies которые мы должны использовать во время взаимодействия с целевой страницей.</p>
	<p>**Формат**: cookiename1=cookievalue1; cookiename2=cookievalue2</p>

    ---

    <ParamItem title="fallbackToActualUA" type="boolean" />
    <p>**true** - при указании данного параметра мы игнорируем неактуальный User Agent, который отправляют в запросе пользователи, и возвращаем с getTaskResult свой (актуальный). Это позволит улучшить принимаемость токенов.</p>
	<p>**false** - мы подставляем User Agent, который указан в запросе. Если User Agent неактуален, то получите ошибку ERROR_WRONG_USERAGENT (USERAGENT IS EXPIRED в логе).</p>

  </TabItem>
  
  <TabItem value="proxy" label="HCaptchaTask (при использовании прокси)" className="bordered-panel">
    <ParamItem title="type" required type="string" />
    **HCaptchaTask**

    ---

    <ParamItem title="websiteURL" required type="string" />
    Адрес страницы на которой решается капча.

    ---

    <ParamItem title="websiteKey" required type="string" />
    Ключ-идентификатор hCaptcha на целевой странице.

    ---

    <ParamItem title="isInvisible" type="boolean" />
    true, если hCaptcha невидимая.

    ---

    <ParamItem title="data" type="string" />
    <p>Дополнительный параметр, используемый в основном с `isInvisible=true`. <br/>
	Значение поля data можно взять из параметра `rqdata`, с которым формируется капча. </p>

    ---

    <ParamItem title="userAgent" type="string" />
    **Передавайте только актуальный UA от ОС Windows. Сейчас таковым является: ** userAgentPlaceholder

    ---

    <ParamItem title="cookies" type="string" />
    <p>Дополнительные cookies которые мы должны использовать во время взаимодействия с целевой страницей.</p>
	<p>**Формат**: cookiename1=cookievalue1; cookiename2=cookievalue2</p>

    ---

    <ParamItem title="fallbackToActualUA" type="boolean" />
    <p>**true** - при указании данного параметра мы игнорируем неактуальный User Agent, который отправляют в запросе пользователи, и возвращаем с getTaskResult свой (актуальный). Это позволит улучшить принимаемость токенов.</p>
	<p>**false** - мы подставляем User Agent, который указан в запросе. Если User Agent неактуален, то получите ошибку ERROR_WRONG_USERAGENT (USERAGENT IS EXPIRED в логе).</p>

    ---

    <ParamItem title="proxyType" required type="string" />
    **http** - обычный http/https прокси;<br />
	**https** - попробуйте эту опцию только если "http" не работает (требуется для некоторых кастомных прокси);<br />
	**socks4** - socks4 прокси;<br />
	**socks5** - socks5 прокси.

    ---

    <ParamItem title="proxyAddress" required type="string" />
    <p>
      IP адрес прокси IPv4/IPv6. Не допускается:
		- использование имен хостов;
		- использование прозрачных прокси (там где можно видеть IP клиента);
		- использование прокси на локальных машинах.
    </p>

    ---

    <ParamItem title="proxyPort" required type="integer" />
    Порт прокси.

    ---

    <ParamItem title="proxyLogin" type="string" />
    Логин прокси-сервера.

    ---

    <ParamItem title="proxyPassword" type="string" />
    Пароль прокси-сервера.

  </TabItem>  
</Tabs>

**Поддерживаемые типы**<br/>
Поддерживаются следующие типы заданий:

|![](./images/hcaptcha-task/Aspose.Words.fa5d4495-c9e9-41f5-8cb9-c4b900b4bbcf.001.png)|![](./images/hcaptcha-task/Aspose.Words.fa5d4495-c9e9-41f5-8cb9-c4b900b4bbcf.002.png)|
| :- | :- |
|![](./images/hcaptcha-task/Aspose.Words.fa5d4495-c9e9-41f5-8cb9-c4b900b4bbcf.003.png)|![](./images/hcaptcha-task/Aspose.Words.fa5d4495-c9e9-41f5-8cb9-c4b900b4bbcf.004.png)|
|![](./images/hcaptcha-task/Aspose.Words.fa5d4495-c9e9-41f5-8cb9-c4b900b4bbcf.005.png)|![](./images/hcaptcha-task/Aspose.Words.fa5d4495-c9e9-41f5-8cb9-c4b900b4bbcf.006.png)|
|![](./images/hcaptcha-task/25940532.png)|


## Метод создания задачи

<Tabs className="full-width-tabs filled-tabs request-tabs" groupId="captcha-type">
	<TabItem value="proxyless" label="HCaptchaTaskProxyless (без прокси)" default className="method-panel">
		<MethodItem>
			```http
			https://api.capmonster.cloud/createTask
			```
		</MethodItem>
		<MethodDescription>
			**Запрос**
			```json
			{
				"clientKey":"API_KEY",
				"task":
				{
					"type":"HCaptchaTaskProxyless",
					"websiteURL":"https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
					"websiteKey":"472fc7af-86a4-4382-9a49-ca9090474471",
					"userAgent": "userAgentPlaceholder",
					"fallbackToActualUA":true
				}
			}
			```
			**Ответ**
			```json
			{
			  "errorId":0,
			  "taskId":407533072
			}
			```
		</MethodDescription>
	</TabItem>

	<TabItem value="proxy" label="HCaptchaTask (при использовании прокси)" className="method-panel">
		<MethodItem>
			```http
			https://api.capmonster.cloud/createTask
			```
		</MethodItem>
		<MethodDescription>
			**Запрос**
			```json
			{
				"clientKey":"API_KEY",
				"task":
				{
					"type":"HCaptchaTask",
					"websiteURL":"https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
					"websiteKey":"472fc7af-86a4-4382-9a49-ca9090474471",
					"userAgent": "userAgentPlaceholder",
					"fallbackToActualUA":true,
					"proxyType":"http",
					"proxyAddress":"8.8.8.8",
					"proxyPort":8080,
					"proxyLogin":"proxyLoginHere",
					"proxyPassword":"proxyPasswordHere"
				}
			}
			```
			**Ответ**
			```json
			{
			  "errorId":0,
			  "taskId":407533072
			}
			```
		</MethodDescription>
	</TabItem>  
</Tabs>


## Метод получения результата задачи
Используйте метод [getTaskResult](../api/methods/get-task-result.md) чтобы получить решение hCaptcha. В зависимости от загрузки системы вы получите ответ через время в диапазоне от 10 с до 80 с.

<TabItem value="proxyless" label="HCaptchaTaskProxyless (без прокси)" default className="method-panel-full">
	<MethodItem>
		```http
		https://api.capmonster.cloud/getTaskResult
		```
	</MethodItem>
	<MethodDescription>
		**Запрос**
		```json
		{
		  "clientKey":"API_KEY",
		  "taskId": 407533072
		}
		```
		**Ответ**
		```json
		{
		  "errorId":0,
		  "status":"ready",
		  "solution": {
			"gRecaptchaResponse": "P1_eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.hKdwYXNza2V5xQb9JvlblBqjTdKpourvlRNpOZLvJb0yJRmsXVFVjyxFWlL1wdYBXaPyFtnxwy2ukbMgwWn62-cjSc98Iw2XIPYWg5MNDKS4_7tBIhjY0PienoKy1...",
			"respKey": "E0_eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoidjQ3RjlqZGFYTllFQXlZZFYyRTlaWlBVQUdLaFpPakpRNjBXRTljVW40VnY3NnhuN2V3R0wwVWd1MW1Wai90WEdoYmt5a2NqVGlGdWpsSlpmVjcza...",
			"userAgent": "userAgentPlaceholder"
		  }
		}
		```
	</MethodDescription>
</TabItem>

<br />

|**Свойство**|**Тип**|**Описание**|
| :- | :- | :- |
|gRecaptchaResponse|String|Хеш, который необходимо подставить в форму с hCaptcha.|
|userAgent|String|Необходимо использовать при сабмите тот же *User Agent*, c которым решалась hCaptcha.|
|respKey|String|Результат функции "window.hcaptcha.getRespKey()" когда она доступна. Часть сайтов используют данное значение для дополнительной проверки.|


## Используйте библиотеку SDK

<Tabs className="full-width-tabs filled-tabs request-tabs" groupId="captcha-type">
  <TabItem value="js" label="JavaScript" default className="method-panel">
	```js
	// https://github.com/ZennoLab/capmonstercloud-client-js

	import { CapMonsterCloudClientFactory, ClientOptions, HCaptchaRequest } from '@zennolab_com/capmonstercloud-client';

	document.addEventListener('DOMContentLoaded', async () => {
	  const cmcClient = CapMonsterCloudClientFactory.Create(new ClientOptions({ clientKey: '<your capmonster.cloud API key>' }));
	  console.log(await cmcClient.getBalance());

	  const hCaptchaRequest = new HCaptchaRequest({
		websiteURL: 'https://lessons.zennolab.com/captchas/hcaptcha/?level=easy',
		websiteKey: '472fc7af-86a4-4382-9a49-ca9090474471',
		isInvisible: true,
		data: 'some data',
		proxyType: 'https',
		proxyAddress: 'https://proxy.com',
		proxyPort: 6045,
		proxyLogin: 'login',
		proxyPassword: 'password',
	  });

	  console.log(await cmcClient.Solve(hCaptchaRequest));
	});
	```
  </TabItem>  
</Tabs>