---
sidebar_position: 5
sidebar_label: HCaptchaTask
draft: true
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import ParamItem from '@theme/ParamItem';
import MethodItem from '@theme/MethodItem';
import MethodDescription from '@theme/MethodDescription'
import PriceBlock from '@theme/PriceBlock';
import PriceBlockWrap from '@theme/PriceBlockWrap';
import { ArticleHead } from '../../src/theme/ArticleHead';

<ArticleHead slug="captchas/hcaptcha-task" />

# HCaptchaTask

<PriceBlockWrap>
  <PriceBlock title="hCaptcha" name="hCaptchaToken"/>
  <PriceBlock title="hCaptcha Enterprise" name="hCaptchaEnterpriseToken"/>
</PriceBlockWrap>

Данный раздел содержит данные о задаче на решение hCaptcha. Для обеспечения универсальности решения этого вида капчи нам необходимо использовать все данные, которые вы используете во время автоматизации заполнения формы на целевом сайте, включая прокси, user-agent браузера и cookies. Это позволит избежать любых проблем при изменении кода hCaptcha.

Капча может решаться довольно долго по сравнению с обычной капчей, но это компенсируется тем, что полученный `g-captcha-response` действует еще 60 секунд после решения капчи.

:::warning **Внимание!**
CapMonster Cloud по умолчанию работает через встроенные прокси — они уже включены в стоимость. Указывать собственные прокси требуется только в тех случаях, когда сайт не принимает токен или доступ к встроенным сервисам ограничен.

Если прокси с авторизацией по IP, то необходимо добавить адрес **65.21.190.34** в белый список.
:::

## Параметры запроса

<Tabs className="full-width-tabs filled-tabs" groupId="captcha-type">
  <TabItem value="proxyless" label="HCaptchaTask (без прокси)" default className="bordered-panel">
    <ParamItem title="type" required type="string" />
    **HCaptchaTask**

    ---

    <ParamItem title="websiteURL" required type="string" />
    Адрес страницы на которой решается капча.

    ---

    <ParamItem title="websiteKey" required type="string" />
    Ключ-идентификатор hCaptcha на целевой странице.

    ---

    <ParamItem title="isInvisible" type="boolean" />
    true, если hCaptcha невидимая.

    ---

    <ParamItem title="data" type="string" />
    <p>Дополнительный параметр, используемый в основном с `isInvisible=true`. <br/>
	Значение поля data можно взять из параметра `rqdata`, с которым формируется капча. </p>

    ---

    <ParamItem title="userAgent" type="string" />
    **Передавайте только актуальный UA от ОС Windows. Сейчас таковым является:** userAgentPlaceholder

    ---

    <ParamItem title="cookies" type="string" />
    <p>Дополнительные cookies которые мы должны использовать во время взаимодействия с целевой страницей.</p>
	<p>**Формат**: cookiename1=cookievalue1; cookiename2=cookievalue2</p>

    ---

    <ParamItem title="fallbackToActualUA" type="boolean" />
    <p>**true** - при указании данного параметра мы игнорируем неактуальный User Agent, который отправляют в запросе пользователи, и возвращаем с getTaskResult свой (актуальный). Это позволит улучшить принимаемость токенов.</p>
	<p>**false** - мы подставляем User Agent, который указан в запросе. Если User Agent неактуален, то получите ошибку ERROR_WRONG_USERAGENT (USERAGENT IS EXPIRED в логе).</p>

  </TabItem>
  
  <TabItem value="proxy" label="HCaptchaTask (при использовании прокси)" className="bordered-panel">
    <ParamItem title="type" required type="string" />
    **HCaptchaTask**

    ---

    <ParamItem title="websiteURL" required type="string" />
    Адрес страницы на которой решается капча.

    ---

    <ParamItem title="websiteKey" required type="string" />
    Ключ-идентификатор hCaptcha на целевой странице.

    ---

    <ParamItem title="isInvisible" type="boolean" />
    true, если hCaptcha невидимая.

    ---

    <ParamItem title="data" type="string" />
    <p>Дополнительный параметр, используемый в основном с `isInvisible=true`. <br/>
	Значение поля data можно взять из параметра `rqdata`, с которым формируется капча. </p>

    ---

    <ParamItem title="userAgent" type="string" />
    **Передавайте только актуальный UA от ОС Windows. Сейчас таковым является:** userAgentPlaceholder

    ---

    <ParamItem title="cookies" type="string" />
    <p>Дополнительные cookies которые мы должны использовать во время взаимодействия с целевой страницей.</p>
	<p>**Формат**: cookiename1=cookievalue1; cookiename2=cookievalue2</p>

    ---

    <ParamItem title="fallbackToActualUA" type="boolean" />
    <p>**true** - при указании данного параметра мы игнорируем неактуальный User Agent, который отправляют в запросе пользователи, и возвращаем с getTaskResult свой (актуальный). Это позволит улучшить принимаемость токенов.</p>
	<p>**false** - мы подставляем User Agent, который указан в запросе. Если User Agent неактуален, то получите ошибку ERROR_WRONG_USERAGENT (USERAGENT IS EXPIRED в логе).</p>

    ---

    <ParamItem title="proxyType" required type="string" />
    **http** - обычный http/https прокси;<br />
	**https** - попробуйте эту опцию только если "http" не работает (требуется для некоторых кастомных прокси);<br />
	**socks4** - socks4 прокси;<br />
	**socks5** - socks5 прокси.

    ---

    <ParamItem title="proxyAddress" required type="string" />
    <p>
      IP адрес прокси IPv4/IPv6. Не допускается:
		- использование имен хостов;
		- использование прозрачных прокси (там где можно видеть IP клиента);
		- использование прокси на локальных машинах.
    </p>

    ---

    <ParamItem title="proxyPort" required type="integer" />
    Порт прокси.

    ---

    <ParamItem title="proxyLogin" type="string" />
    Логин прокси-сервера.

    ---

    <ParamItem title="proxyPassword" type="string" />
    Пароль прокси-сервера.

  </TabItem>  
</Tabs>

## Поддерживаемые типы заданий
Поддерживаются все основные типы заданий, например:

- **DragAndDrop** - перетаскивание элементов в нужные места 
- **Click** - клик по элементу
- **3x3 / YesNo** - выбор изображений по условию


## Метод создания задачи

<Tabs className="full-width-tabs filled-tabs request-tabs" groupId="captcha-type">
	<TabItem value="proxyless" label="HCaptchaTask (без прокси)" default className="method-panel">
		<MethodItem>
			```http
			https://api.capmonster.cloud/createTask
			```
		</MethodItem>
		<MethodDescription>
  **Запрос**
  ```json
  {
    "clientKey":"API_KEY",
    "task":
    {
      "type":"HCaptchaTask",
      "websiteURL":"https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
      "websiteKey":"472fc7af-86a4-4382-9a49-ca9090474471",
      "userAgent": "userAgentPlaceholder",
      "fallbackToActualUA":true
    }
  }
  ```
  **Ответ**
  ```json
  {
    "errorId":0,
    "taskId":407533072
  }
			```
		</MethodDescription>
	</TabItem>

	<TabItem value="proxy" label="HCaptchaTask (при использовании прокси)" className="method-panel">
		<MethodItem>
			```http
			https://api.capmonster.cloud/createTask
			```
		</MethodItem>
		<MethodDescription>
  **Запрос**
  ```json
  {
    "clientKey":"API_KEY",
    "task":
    {
      "type":"HCaptchaTask",
      "websiteURL":"https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
      "websiteKey":"472fc7af-86a4-4382-9a49-ca9090474471",
      "userAgent": "userAgentPlaceholder",
      "fallbackToActualUA":true,
      "proxyType":"http",
      "proxyAddress":"8.8.8.8",
      "proxyPort":8080,
      "proxyLogin":"proxyLoginHere",
      "proxyPassword":"proxyPasswordHere"
    }
  }
  ```
  **Ответ**
  ```json
  {
    "errorId":0,
    "taskId":407533072
  }
  ```
		</MethodDescription>
	</TabItem>  
</Tabs>


## Метод получения результата задачи
Используйте метод [getTaskResult](../api/methods/get-task-result) чтобы получить решение hCaptcha. В зависимости от загрузки системы вы получите ответ через время в диапазоне от 10 с до 80 с.

<TabItem value="proxyless" label="HCaptchaTask (без прокси)" default className="method-panel-full">
	<MethodItem>
		```http
		https://api.capmonster.cloud/getTaskResult
		```
	</MethodItem>
	<MethodDescription>
  **Запрос**
  ```json
  {
    "clientKey":"API_KEY",
    "taskId": 407533072
  }
  ```
  **Ответ**
  ```json
  {
    "errorId": 0,
    "status": "ready",
    "solution": {
      "gRecaptchaResponse": "P1_eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.hKdwYXNza2V5xQb9JvlblBqjTdKpourvlRNpOZLvJb0yJRmsXVFVjyxFWlL1wdYBXaPyFtnxwy2ukbMgwWn62-cjSc98Iw2XIPYWg5MNDKS4_7tBIhjY0PienoKy1...",
      "respKey": "E0_eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoidjQ3RjlqZGFYTllFQXlZZFYyRTlaWlBVQUdLaFpPakpRNjBXRTljVW40VnY3NnhuN2V3R0wwVWd1MW1Wai90WEdoYmt5a2NqVGlGdWpsSlpmVjcza...",
      "userAgent": "userAgentPlaceholder"
    }
  }
  ```
	</MethodDescription>
</TabItem>

<br />

|**Свойство**|**Тип**|**Описание**|
| :- | :- | :- |
|gRecaptchaResponse|String|Хеш, который необходимо подставить в форму с hCaptcha.|
|userAgent|String|Необходимо использовать при сабмите тот же *User Agent*, c которым решалась hCaptcha.|
|respKey|String|Результат функции "window.hcaptcha.getRespKey()" когда она доступна. Часть сайтов используют данное значение для дополнительной проверки.|

---

# Получение параметров hCaptcha

Для успешного решения hCaptcha через API необходимо получить обязательные параметры страницы: `websiteKey`, а в случае Invisible-версии — также `data` (`rqdata`).

Ниже приведены основные способы их определения.

---

## 1. Параметр `websiteKey`

### Способ 1: Через вкладку Network (Сеть)

1. Откройте **Инструменты разработчика (DevTools)**.
2. Перейдите на вкладку **Network**.
3. Перезагрузите страницу с hCaptcha.
4. В списке запросов найдите URL, начинающийся с:

```
checksiteconfig?v=
```

5. Для быстрого поиска нажмите:

   * **Ctrl + F** (Windows)
   * **Command + F** (macOS)

   и введите ключевое слово:

```
key
```

В найденных запросах будет указан параметр `sitekey` — это и есть значение `websiteKey`.

---

### Способ 2: Через вкладку Elements (Элементы)

1. Перейдите во вкладку **Elements**.
2. Выполните поиск по странице:

   * `data-sitekey`
   * `sitekey`

Чаще всего параметр выглядит так:

```html
<div class="h-captcha" data-sitekey="XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"></div>
```

Значение атрибута `data-sitekey` и есть `websiteKey`.

---

## 2. Параметр `data` (rqdata) — для HCaptcha Invisible

На некоторых сайтах (особенно при использовании Invisible-версии) дополнительно требуется параметр `rqdata`.

### Важно

Значение `rqdata`:

* является **одноразовым**;
* генерируется заново при каждом обновлении страницы;
* повторное использование старого значения приведёт к ошибке.

---

### Способ 1: Поиск в исходном коде страницы

Иногда параметр можно найти напрямую в JavaScript-коде, например:

```js
hcaptcha.setData({ rqdata: "value" })
```

В этом случае строка `"value"` и будет искомым параметром `data`.

---

### Способ 2: Через вкладку Network

1. Откройте **DevTools → Network**.
2. Перезагрузите страницу с капчей.
3. Нажмите **Ctrl + F** (или Command + F на macOS).
4. Введите в поиск:

```
data
```

Чаще всего параметр встречается в запросах, связанных с:

* авторизацией (`login`)
* регистрацией (`signup`)
* подтверждением действий

Просмотрите такие запросы и найдите поле `rqdata`.

---

## 3. Поиск параметров в запросе `refreshcaptcha`

На некоторых сайтах параметры hCaptcha передаются в специальном запросе:

```
refreshcaptcha
```

### Порядок действий:

1. Откройте **DevTools → Network**.
2. Перезагрузите страницу.
3. Найдите запрос `refreshcaptcha`.
4. Перейдите во вкладку **Response**.

Для сервиса CapMonster Cloud в этом случае используются параметры:

* `gid`
* `sitekey`

### Важно

Значение `gid` соответствует параметру `data`.

При составлении запроса на решение:

* `sitekey` → используется как `websiteKey`
* `gid` → используется как `data`

---

## 4. Поиск параметров в API-запросах сайта

Иногда параметры hCaptcha передаются не напрямую, а внутри внутренних API-запросов сайта.

Чаще всего такие запросы выполняются:

* при авторизации,
* при регистрации,
* при отправке формы.

Например:

```
https://authenticate.example.com/api/v1/login
```

Откройте соответствующий запрос во вкладке **Network** и проверьте:

* тело запроса (Request Payload),
* ответ сервера (Response).

Параметры `sitekey`, `rqdata`, `gid` могут передаваться внутри этих данных.

---

## Рекомендации

* Всегда обновляйте страницу перед копированием `rqdata`.
* Проверяйте, не генерируются ли параметры динамически.
* Если параметр отсутствует в HTML, ищите его в сетевых запросах.

---

## Используйте библиотеку SDK

<Tabs className="full-width-tabs filled-tabs request-tabs" groupId="captcha-type">
  <TabItem value="js" label="JavaScript" default className="method-panel">
  <details>
      <summary>Показать код (для браузера)</summary>
```js
// https://github.com/ZennoLab/capmonstercloud-client-js

import { CapMonsterCloudClientFactory, ClientOptions, HCaptchaRequest } from '@zennolab_com/capmonstercloud-client';

const API_KEY = "YOUR_API_KEY"; // Укажите ваш API-ключ CapMonster Cloud

document.addEventListener("DOMContentLoaded", async () => {
    const client = CapMonsterCloudClientFactory.Create(
        new ClientOptions({ clientKey: API_KEY })
    );

    // Базовый пример без прокси
    // CapMonster Cloud автоматически использует свои прокси
    let hcaptchaRequest = new HCaptchaRequest({
        websiteURL: "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy", // URL страницы с hCaptcha
        websiteKey: "472fc7af-86a4-4382-9a49-ca9090474471",
        isInvisible: false, // true -- если используется Invisible hCaptcha
        data: "rqdata_value_if_required" // Обязательный параметр для некоторых реализаций Invisible
    });

    // Пример использования вашего собственного прокси
    // Раскомментируйте данный блок, если вы хотите использовать собственный прокси
    /*
    const proxy = {
        proxyType: "http",
        proxyAddress: "123.45.67.89",
        proxyPort: 8080,
        proxyLogin: "username",
        proxyPassword: "password"
    };

    hcaptchaRequest = new HCaptchaRequest({
        websiteURL: "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
        websiteKey: "472fc7af-86a4-4382-9a49-ca9090474471",
        isInvisible: false,
        data: "rqdata_value_if_required",
        proxy,
        userAgent: "userAgentPlaceholder"
    });
    */

    // При необходимости можно проверить баланс
    const balance = await client.getBalance();
    console.log("Balance:", balance);

    const result = await client.Solve(hcaptchaRequest);
    console.log("Solution:", result);
});
```
</details>

<details>
      <summary>Показать код (Node.js)</summary>
```JavaScript
  // https://github.com/ZennoLab/capmonstercloud-client-js

  import { CapMonsterCloudClientFactory, ClientOptions, HCaptchaRequest } from '@zennolab_com/capmonstercloud-client';

  const API_KEY = "YOUR_API_KEY"; // Укажите ваш API-ключ CapMonster Cloud

  async function solveHCaptcha() {
      const client = CapMonsterCloudClientFactory.Create(
          new ClientOptions({ clientKey: API_KEY })
      );

      // Базовый пример без прокси
      // CapMonster Cloud автоматически использует свои прокси
      let hcaptchaRequest = new HCaptchaRequest({
          websiteURL: "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy", // URL страницы с hCaptcha
          websiteKey: "472fc7af-86a4-4382-9a49-ca9090474471",
          isInvisible: false,     // true -- если используется Invisible hCaptcha
          data: "rqdata_value_if_required" // Обязательный параметр для некоторых реализаций Invisible
      });

      // Пример использования вашего собственного прокси
      // Раскомментируйте данный блок, если вы хотите использовать собственный прокси

      /*
      const proxy = {
          proxyType: "http",
          proxyAddress: "123.45.67.89",
          proxyPort: 8080,
          proxyLogin: "username",
          proxyPassword: "password"
      };

      hcaptchaRequest = new HCaptchaRequest({
          websiteURL: "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
          websiteKey: "472fc7af-86a4-4382-9a49-ca9090474471",
          isInvisible: false,
          data: "rqdata_value_if_required",
          proxy,
          userAgent: "userAgentPlaceholder"
      });
      */

      // При необходимости можно проверить баланс
      const balance = await client.getBalance();
      console.log("Balance:", balance);

      const result = await client.Solve(hcaptchaRequest);
      console.log("Solution:", result);
  }

  solveHCaptcha().catch(console.error);
```
</details>

  </TabItem>


  <TabItem value="python" label="Python" className="method-panel">
```python
# https://github.com/ZennoLab/capmonstercloud-client-python

import asyncio
from capmonstercloudclient import CapMonsterClient, ClientOptions
from capmonstercloudclient.requests import HcaptchaRequest
# from capmonstercloudclient.requests.baseRequestWithProxy import ProxyInfo  # Раскомментируйте, если планируете использовать прокси

API_KEY = "YOUR_API_KEY"  # Укажите ваш API-ключ CapMonster Cloud

async def solve_hcaptcha():
    client_options = ClientOptions(api_key=API_KEY)
    cap_monster_client = CapMonsterClient(options=client_options)

    # Базовый пример без прокси
    # CapMonster Cloud автоматически использует свои прокси
    hcaptcha_request = HcaptchaRequest(
        websiteUrl="https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",  # URL страницы с капчей
        websiteKey="472fc7af-86a4-4382-9a49-ca9090474471",
        isInvisible=False,  # True, если капча невидимая
        userAgent="userAgentPlaceholder",
        fallbackToActualUA=True
    )

    # Пример использования вашего собственного прокси
    # Раскомментируйте данный блок, если вы хотите использовать собственный прокси

    # proxy = ProxyInfo(
    #     proxyType="http",
    #     proxyAddress="123.45.67.89",
    #     proxyPort=8080,
    #     proxyLogin="username",
    #     proxyPassword="password"
    # )
    #
    # hcaptcha_request = HcaptchaRequest(
    #     websiteUrl="https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
    #     websiteKey="472fc7af-86a4-4382-9a49-ca9090474471",
    #     isInvisible=False,
    #     userAgent="userAgentPlaceholder",
    #     fallbackToActualUA=True,
    #     proxy=proxy
    # )

    # При необходимости можно проверить баланс
    balance = await cap_monster_client.get_balance()
    print("Balance:", balance)

    result = await cap_monster_client.solve_captcha(hcaptcha_request)
    print("Solution:", result)

asyncio.run(solve_hcaptcha())
```
  </TabItem>

  <TabItem value="csharp" label="C#" className="method-panel">
```csharp
// https://github.com/ZennoLab/capmonstercloud-client-dotnet

using System;
using System.Threading.Tasks;
using Zennolab.CapMonsterCloud;
using Zennolab.CapMonsterCloud.Requests;

class Program
{
    static async Task Main(string[] args)
    {
        // Ваш API-ключ от CapMonster Cloud
        var clientOptions = new ClientOptions
        {
            ClientKey = "YOUR_API_KEY"
        };

        var cmCloudClient = CapMonsterCloudClientFactory.Create(clientOptions);

        // Базовый пример без прокси
        // CapMonster Cloud автоматически использует свои прокси
        var hcaptchaRequest = new HCaptchaRequest
        {
            WebsiteUrl = "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy", // URL страницы с капчей
            WebsiteKey = "472fc7af-86a4-4382-9a49-ca9090474471",
            Invisible = false,   // true -- если используется невидимая капча
            UserAgent = "userAgentPlaceholder"
        };

        // Пример использования вашего собственного прокси
        // Раскомментируйте данный блок, если вы хотите использовать собственный прокси
        
        /*
        hcaptchaRequest = new HCaptchaRequest
        {
            WebsiteUrl = "https://lessons.zennolab.com/captchas/hcaptcha/?level=easy",
            WebsiteKey = "472fc7af-86a4-4382-9a49-ca9090474471",
            Invisible = false,
            UserAgent = "userAgentPlaceholder",

            Proxy = new ProxyContainer(
                "123.45.67.89",
                8080,  
                ProxyType.Http,  
                "username",    
                "password"  
            )
        };
        */

        // При необходимости можно проверить баланс
        var balance = await cmCloudClient.GetBalanceAsync();
        Console.WriteLine("Balance: " + balance);

        var hcaptchaResult = await cmCloudClient.SolveAsync(hcaptchaRequest);

        Console.WriteLine("HCaptcha Solution: " + hcaptchaResult.Solution.Value);
    }
}
```
  </TabItem>  
</Tabs>
