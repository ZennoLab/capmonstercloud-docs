---
sidebar_position: 1
sidebar_label: reCAPTCHA v3
title: "Распознавание и решение reCAPTCHA v3 через прокси — reCAPTCHA v3 Task | API"
description: "Подробное описание решения задачи reCAPTCHA v3 Task с использованием прокси-сервера для автоматизированного распознавания и решения (обхода) reCAPTCHA v3 в документации в Capmonster Cloud Docs."
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import ParamItem from '@theme/ParamItem';
import MethodItem from '@theme/MethodItem';
import MethodDescription from '@theme/MethodDescription'
import PriceBlock from '../../src/theme/PriceBlock';
import PriceBlockWrap from '@theme/PriceBlockWrap';
import BlogLink from '@theme/BlogLink';
import { ArticleHead } from '../../src/theme/ArticleHead';

<ArticleHead slug="captchas/recaptcha-v3-task" />


# reCAPTCHA v3

<PriceBlockWrap>
  <PriceBlock title="RecaptchaV3" captchaId="recaptcha3"/>
</PriceBlockWrap>

![](./images/recaptcha-v3/recaptchaV3.png)

:::warning **Внимание!**
Задача выполняется через наши собственные прокси-серверы. Дополнительных расходов на прокси не требуется — их использование включено в стоимость.
:::

Данный раздел содержит описание задачи для решения reCAPTCHA v3 от Google. 

reCAPTCHA v3 работает полностью в фоновом режиме и не требует от пользователя выполнения каких-либо действий. Система анализирует поведенческие и технические сигналы посетителя страницы и формирует оценку риска для каждого запроса. На основе полученных данных сайт принимает решение о допустимости действия, используя рейтинг доверия, который обычно находится в диапазоне от **0.1** до **0.9**.

При создании задачи желательно передавать два параметра - `pageAction` и `minScore`.

## Параметры запроса

<TabItem value="proxyless" label="RecaptchaV3TaskProxyless (без прокси)" default className="bordered-panel">
    <ParamItem title="type" required type="string" />
    **RecaptchaV3TaskProxyless**

    ---

    <ParamItem title="websiteURL" required type="string" />
    Адрес страницы, на которой решается капча

    ---

    <ParamItem title="websiteKey" required type="string" />
   Ключ-идентификатор ReCaptcha3 на целевой странице.
   <br/>https://www.google.com/recaptcha/api.js?render=THIS_ONE

   ---

   <ParamItem title="isEnterprise" type="boolean" />
   Версия reCAPTCHA. Поддерживаемые значения: `true` / `false` (также допускается `1` / `0`, тип integer).
   
   Укажите `true`, если необходимо решить reCAPTCHA в версии Enterprise — в этом случае задача будет обрабатываться так же, как [RecaptchaV3EnterpriseTask](../recaptcha-v3-enterprise-task/).

    ---

   <ParamItem title="minScore" type="double" />
    Может иметь значение от 0.1 до 0.9

   ---

    <ParamItem title="pageAction" type="string" />
    <p>Значение параметра action, которое передаётся виджетом ReCaptcha в Google и который при последующей верификации на сервере виден владельцу сайта. Указывайте этот параметр, если его значение отличается от значения по умолчанию: *verify*</p>
	<p>Пример в html:
	<br/>*`grecaptcha.execute('site_key', {action:'login_test'})`*.</p>
</TabItem>


## Метод создания задачи
<TabItem value="proxyless" label="RecaptchaV3TaskProxyless (без прокси)" default className="method-panel">
	<MethodItem>
		```http
		https://api.capmonster.cloud/createTask
		```
	</MethodItem>
	<MethodDescription>
		**Запрос**
        ```json
          {
            "clientKey": "API_KEY",
            "task": {
              "type": "RecaptchaV3TaskProxyless",
              "websiteURL": "https://lessons.zennolab.com/captchas/recaptcha/v3.php?level=beta",
              "websiteKey": "6Le0xVgUAAAAAIt20XEB4rVhYOODgTl00d8juDob",
              "isEnterprise": false,
              "minScore": 0.7,
              "pageAction": "myverify"
            }
          }
      ```

		**Ответ**
		```json
		{
		  "errorId":0,
		  "taskId":407533072
		}
		```
	</MethodDescription>
</TabItem>


## Метод получения результата задачи

:::warning **Внимание!**
На некоторых сайтах важно, чтобы UserAgent совпадал с тем, что использовался при решении капчи. Поэтому, если вместе с токеном CapMonster Cloud возвращает UserAgent, **обязательно** применяйте его при отправке формы или подтверждении решения на целевой странице.
:::

Используйте метод [getTaskResult](../api/methods/get-task-result.mdx), чтобы получить решение ReCaptcha3. В зависимости от загрузки системы вы получите ответ через время в диапазоне от 10 с до 30 с.

<TabItem value="proxyless" label="RecaptchaV3TaskProxyless (без прокси)" default className="method-panel-full">
	<MethodItem>
		```http
		https://api.capmonster.cloud/getTaskResult
		```
	</MethodItem>
	<MethodDescription>
		**Запрос**
		```json
		{
		  "clientKey":"API_KEY",
		  "taskId": 407533072
		}
		```
		**Ответ**
		```json
		{
		  "errorId":0,
		  "status":"ready",
		  "solution": {
			"gRecaptchaResponse":"3AHJ_VuvYIBNBW5yyv0zRYJ75VkOKvhKj9_xGBJKnQimF72rfoq3Iy-DyGHMwLAo6a3"
		  }
		}
		```

    Для некоторых сайтов ответ может выглядеть следующим образом. При отправке решения необходимо использовать UserAgent, указанный в ответе, даже если он отличается от текущего, используемого вашим браузером или скриптом.
 
```json
{
  "errorId": 0,
  "status": "ready",
  "solution": {
    "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36",
    "gRecaptchaResponse": "0cAFcWeA5Y3...hF8UWA",
    "cookies": {
      "nocookies": "true"
    }
  }
}
```
	</MethodDescription>
</TabItem>

<br />

|**Свойство**|**Тип**|**Описание**|
| :- | :- | :- |
|gRecaptchaResponse|String|Хеш, который необходимо подставить в форму с ReCaptcha3 в `<textarea id="g-recaptcha-response" ></textarea>`. Имеет длину от 500 до 2190 байт.|

## Как найти все нужные параметры для создания задачи на решение

### Вручную

1. Откройте ваш сайт, где отображается капча, в браузере.
2. Правой кнопкой кликните по элементу капчи и выберите **Inspect**.

#### websiteKey

Публичный ключ сайта (sitekey). Обычно его можно найти в подключаемом скрипте: 

В **Elements**:

![elements](images\recaptcha-v3\sitekey-elements.png)

Во вкладке **Network**:

![network](images\recaptcha-v3\sitekey-network.png)

#### pageAction

Название действия, передаваемое в *grecaptcha.execute().* Например:​

![action](images\recaptcha-v3\action.png)

### Автоматически

Для автоматизации поиска параметров их можно извлекать через **браузер** (обычный или headless, например, с **Playwright**) или напрямую из **HTTP-запросов**. Поскольку значения динамических параметров действуют недолго, их рекомендуется использовать сразу после получения.

:::warning **Важно!**
Приведённые фрагменты кода являются базовыми примерами для ознакомления в извлечении необходимых параметров. Точная реализация будет зависеть от вашего сайта с капчей, его структуры и используемых HTML-элементов и селекторов.
:::

<Tabs className="full-width-tabs filled-tabs request-tabs">
  <TabItem value="js" label="JavaScript" default className="method-panel">
    <details>
      <summary>Показать код (в браузере)</summary>

      ```js
      (() => {
          const originalGrecaptcha = window.grecaptcha;

          if (!originalGrecaptcha || !originalGrecaptcha.execute) {
              console.warn("grecaptcha.execute not found. Wait until it loads.");
              return;
          }

          window.__extractedParams = null;

          window.grecaptcha = {
              ...originalGrecaptcha,
              execute: function(sitekey, config) {
                  console.log("Captured!");
                  console.log("sitekey:", sitekey);
                  console.log("action:", config?.action);
                  window.__extractedParams = {
                      sitekey,
                      action: config?.action
                  };

                  return originalGrecaptcha.execute(sitekey, config);
              },
              ready: originalGrecaptcha.ready
          };

          console.log("grecaptcha.execute is wrapped. Click the button - parameters will be captured.");
      })();
      ```
    </details>

    <details>
      <summary>Показать код (Node.js)</summary>

      ```js
      import { chromium } from "playwright";

      (async () => {
        const browser = await chromium.launch({ headless: false });
        const context = await browser.newContext();
        const page = await context.newPage();

        const jsContents = [];

        page.on("response", async (response) => {
          try {
            const url = response.url();
            const ct = response.headers()["content-type"] || "";
            if (ct.includes("javascript") || url.endsWith(".js")) {
              const text = await response.text();
              jsContents.push(text);
            }
          } catch (e) {}
        });

        const targetUrl = "https://lessons.zennolab.com/captchas/recaptcha/v3.php?level=beta";
        await page.goto(targetUrl, { timeout: 60000 });
        await page.waitForTimeout(3000);

        const inlineScripts = await page.$$eval("script:not([src])", (scripts) =>
          scripts.map((s) => s.textContent)
        );
        jsContents.push(...inlineScripts);

        const executeRegex =
          /grecaptcha\.execute\(\s*['"]
          (?<sitekey>[^'"]+)['"]\s*,\s*\{[^}]*action\s*:\s*['"](?<action>[^'"]+)['"]/i;

        let foundSitekey = null;
        let foundAction = null;

        for (const js of jsContents) {
          const match = js.match(executeRegex);
          if (match && match.groups) {
            foundSitekey = match.groups.sitekey;
            foundAction = match.groups.action;
            break;
          }
        }

        console.log({
          sitekey: foundSitekey,
          action: foundAction,
        });

        await browser.close();
      })();
      ```
    </details>
  </TabItem>

  <TabItem value="python" label="Python" className="method-panel">
    <details>
      <summary>Показать код</summary>

      ```python
      import asyncio
      import re
      from playwright.async_api import async_playwright

      async def extract_recaptcha_v3_execute(url):
          async with async_playwright() as p:
              browser = await p.chromium.launch(headless=False)
              context = await browser.new_context()
              page = await context.new_page()

              execute_pattern = re.compile(
                  r"grecaptcha\.execute\(\s*['\"]
                  (?P<sitekey>[^'\"]+)['\"]\s*,\s*\{[^}]*action\s*:\s*['\"](?P<action>[^'\"]+)['\"]",
                  re.IGNORECASE
              )

              found_sitekey = None
              found_action = None
              js_contents = []

              async def handle_response(response):
                  try:
                      ct = response.headers.get("content-type", "")
                      if "javascript" in ct or response.url.endswith(".js"):
                          text = await response.text()
                          js_contents.append(text)
                  except:
                      pass

              page.on("response", handle_response)

              await page.goto(url, timeout=60000)
              await page.wait_for_timeout(3000)

              inline_scripts = await page.locator("script:not([src])").all_text_contents()
              js_contents += inline_scripts

              for js in js_contents:
                  match = execute_pattern.search(js)
                  if match:
                      found_sitekey = match.group("sitekey")
                      found_action = match.group("action")
                      break

              await browser.close()

              print({
                  "sitekey": found_sitekey,
                  "action": found_action
              })

      asyncio.run(extract_recaptcha_v3_execute("https://lessons.zennolab.com/captchas/recaptcha/v3.php?level=beta"))
      ```
    </details>
  </TabItem>

  <TabItem value="csharp" label="C#" className="method-panel">
    <details>
      <summary>Показать код</summary>

      ```csharp
      using System;
      using System.Text.RegularExpressions;
      using System.Threading.Tasks;
      using Microsoft.Playwright;
      using System.Collections.Generic;

      class Program
      {
          public static async Task Main(string[] args)
          {
              await ExtractRecaptchaV3Execute
              ("https://lessons.zennolab.com/captchas/recaptcha/v3.php?level=beta");
          }

          public static async Task ExtractRecaptchaV3Execute(string url)
          {
              using var playwright = await Playwright.CreateAsync();
              var browser = await playwright.Chromium.LaunchAsync(new BrowserTypeLaunchOptions
              {
                  Headless = false
              });

              var context = await browser.NewContextAsync();
              var page = await context.NewPageAsync();

              string foundSitekey = null;
              string foundAction = null;
              var jsContents = new List<string>();

              page.Response += async (_, response) =>
              {
                  try
                  {
                      var ct = response.Headers.ContainsKey("content-type") ? 
                      response.Headers["content-type"] : "";
                      if ((ct != null && ct.Contains("javascript")) || response.Url.EndsWith(".js"))
                      {
                          var text = await response.TextAsync();
                          jsContents.Add(text);
                      }
                  }
                  catch { }
              };

              await page.GotoAsync(url, new PageGotoOptions { Timeout = 60000 });
              await page.WaitForTimeoutAsync(3000);

              var inlineScripts = await page.EvalOnSelectorAllAsync<string[]>(
                  "script:not([src])",
                  "els => els.map(e => e.textContent)"
              );
              jsContents.AddRange(inlineScripts);

              var regex = new Regex(@"grecaptcha\.execute\(\s*['""]
              (?<sitekey>[^'""]+)['""]\s*,\s*\{[^}]*action\s*:\s*['""](?<action>[^'""]+)['""]", 
              RegexOptions.IgnoreCase);

              foreach (var js in jsContents)
              {
                  var match = regex.Match(js);
                  if (match.Success)
                  {
                      foundSitekey = match.Groups["sitekey"].Value;
                      foundAction = match.Groups["action"].Value;
                      break;
                  }
              }

              Console.WriteLine($"sitekey: {foundSitekey}");
              Console.WriteLine($"action: {foundAction}");

              await browser.CloseAsync();
          }
      }
      ```
    </details>
  </TabItem>
</Tabs>

## Используйте библиотеку SDK

<Tabs className="full-width-tabs filled-tabs request-tabs" groupId="captcha-type">
  <TabItem value="js" label="JavaScript" default className="method-panel">
  <details>
      <summary>Показать код (для браузера)</summary>
    ```js
    // https://github.com/ZennoLab/capmonstercloud-client-js

    import {
      CapMonsterCloudClientFactory,
      ClientOptions,
      RecaptchaV3ProxylessRequest
    } from '@zennolab_com/capmonstercloud-client';

    document.addEventListener('DOMContentLoaded', async () => {

      const cmcClient = CapMonsterCloudClientFactory.Create(
        new ClientOptions({ clientKey: 'YOUR_API_KEY' }) // Укажите ваш API-ключ CapMonster Cloud
      );

      // При необходимости можно проверить баланс
      const balance = await cmcClient.getBalance();
      console.log('Balance:', balance);

      const recaptchaV3Request = new RecaptchaV3ProxylessRequest({
        websiteURL: 'https://lessons.zennolab.com/captchas/recaptcha/v3.php?level=beta', // URL вашей страницы с капчей
        websiteKey: '6Le0xVgUAAAAAIt20XEB4rVhYOODgTl00d8juDob',
        minScore: 0.6,  
        pageAction: 'myverify',
      });

      const solution = await cmcClient.Solve(recaptchaV3Request);
      console.log('Solution:', solution);

    });
```
</details>

<details>
      <summary>Показать код (Node.js)</summary>

      ```javascript
      // https://github.com/ZennoLab/capmonstercloud-client-js

      import { CapMonsterCloudClientFactory, ClientOptions, RecaptchaV3ProxylessRequest } from '@zennolab_com/capmonstercloud-client';

      const API_KEY = "YOUR_API_KEY"; // Укажите ваш API-ключ CapMonster Cloud

      async function solveRecaptchaV3() {
          const cmcClient = CapMonsterCloudClientFactory.Create(
              new ClientOptions({ clientKey: API_KEY })
          );

          // При необходимости можно проверить баланс
          const balance = await cmcClient.getBalance();
          console.log("Balance:", balance);

          const recaptchaV3Request = new RecaptchaV3ProxylessRequest({
              websiteURL: "https://lessons.zennolab.com/captchas/recaptcha/v3.php?level=beta",
              websiteKey: "6Le0xVgUAAAAAIt20XEB4rVhYOODgTl00d8juDob",
              minScore: 0.6,
              pageAction: "myverify",
          });

          const solution = await cmcClient.Solve(recaptchaV3Request);
          console.log("Solution:", solution);
      }

      solveRecaptchaV3().catch(console.error);
      ```
      </details>


<BlogLink url="https://capmonster.cloud/ru/blog/re-1/javascript-recaptcha-v3"/>

  </TabItem>

  <TabItem value="python" label="Python" className="method-panel">

  <details>
      <summary>Показать код</summary>

```python
# https://github.com/Zennolab/capmonstercloud-client-python

import asyncio
from capmonstercloudclient import CapMonsterClient, ClientOptions
from capmonstercloudclient.requests import RecaptchaV3ProxylessRequest

client_options = ClientOptions(api_key="YOUR_API_KEY")  # Ваш API-ключ CapMonster Cloud
cap_monster_client = CapMonsterClient(options=client_options)

# При необходимости можно проверить баланс
balance = asyncio.run(cap_monster_client.get_balance())
print("Balance:", balance)

recaptcha_v3_request = RecaptchaV3ProxylessRequest(
    websiteUrl="https://lessons.zennolab.com/captchas/recaptcha/v3.php?level=beta",  # URL вашей страницы с капчей
    websiteKey="6Le0xVgUAAAAAIt20XEB4rVhYOODgTl00d8juDob",  # Замените на корректное значение
    minScore=0.6,  
    pageAction="myverify"  
)

async def solve_captcha():
    return await cap_monster_client.solve_captcha(recaptcha_v3_request)

responses = asyncio.run(solve_captcha())
print(responses)
```
</details>

<BlogLink url="https://capmonster.cloud/ru/blog/re-1/python-recaptcha-v3"/>

  </TabItem>

  <TabItem value="csharp" label="C#" className="method-panel">

<details>
      <summary>Показать код</summary>

```csharp
// https://github.com/ZennoLab/capmonstercloud-client-dotnet

using Zennolab.CapMonsterCloud.Requests;
using Zennolab.CapMonsterCloud;

class Program
{
    static async Task Main(string[] args)
    {
        var clientOptions = new ClientOptions
        {
            ClientKey = "YOUR_API_KEY"  // Ваш API-ключ CapMonster Cloud
        };

        var cmCloudClient = CapMonsterCloudClientFactory.Create(clientOptions);

        // При необходимости можно проверить баланс
        var balance = await cmCloudClient.GetBalanceAsync();
        Console.WriteLine("Balance: " + balance);

        var recaptchaV3Request = new RecaptchaV3ProxylessRequest
        {
            WebsiteUrl = "https://lessons.zennolab.com/captchas/recaptcha/v3.php?level=beta",  // URL вашей страницы с капчей
            WebsiteKey = "6Le0xVgUAAAAAIt20XEB4rVhYOODgTl00d8juDob",
            MinScore = 0.6,
            PageAction = "myverify"
        };

        var recaptchaV3Result = await cmCloudClient.SolveAsync(recaptchaV3Request);

        Console.WriteLine("Solution: " + recaptchaV3Result.Solution.Value);
    }
}
```

</details>

<BlogLink url="https://capmonster.cloud/ru/blog/re-1/c-recaptcha-v3"/>

  </TabItem>
</Tabs>
